library(dplyr)
opts_chunk$set(echo = TRUE)
ln1 <- matrix(runif(6), ncol=2) %>% Line()
str(ln1)
ln1 <- matrix(runif(6), ncol=2) %>% Line()
str(ln1)
library(knitr)
# library(sf)
library(sp)
# library(rgdal)
# library(raster)
# library(rgeos)
library(dplyr)
opts_chunk$set(echo = TRUE)
ln1 <- matrix(runif(6), ncol=2) %>% Line()
str(ln1)
ln1
ln1 <- matrix(runif(6), ncol=2) %>% Line()
str(ln1); ln1
ln2 <- Line(matrix(runif(6), ncol=2))
ln2
lns1 <- Lines(list(ln1), ID = c("hwy1"))
lns2 <- Lines(list(ln2), ID = c("hwy2"))
str(lns1)
sp_lns <- SpatialLines(list(lns1, lns2))
str(sp_lns)
sp_lns@bbox
ln1@coords
ln1@coords[1]
ln1@coords[1,]
ln1@coords[,1]
ln1@coords[,1] %>% range
ln1@coords[,2] %>% range
sp_lns@bbox
ln1@coords[,1] %>% range
ln1@coords[,2] %>% range
ln2@coords[,1] %>% range
ln2@coords[,2] %>% range
dfr <- data.frame(id = c("hwy1", "hwy2"), # note how we use the same IDs from above!
cars_per_hour = c(78, 22))
sp_lns_dfr <- SpatialLinesDataFrame(sp_lns, dfr, match.ID = "id")
str(sp_lns_dfr)
# dfr <- data.frame(id = c("hwy1", "hwy2"), # note how we use the same IDs from above!
dfr <- data.frame(id = c("hwy2", "hwy1"), # note how we use the same IDs from above!
cars_per_hour = c(78, 22))
sp_lns_dfr <- SpatialLinesDataFrame(sp_lns, dfr, match.ID = "id")
str(sp_lns_dfr)
dfr <- data.frame(id = c("hwy1", "hwy2"), # note how we use the same IDs from above!
cars_per_hour = c(78, 22))
sp_lns_dfr <- SpatialLinesDataFrame(sp_lns, dfr, match.ID = "id")
str(sp_lns_dfr)
Sys.Date()
Sys.time()
Sys.timezone()
str(OlsonNames())
OlsonNames() %>% View()
lnstr_sfg1 <- st_linestring(matrix(runif(6), ncol=2))
library(knitr)
library(sf)
library(sp)
# library(rgdal)
# library(raster)
# library(rgeos)
library(dplyr)
opts_chunk$set(echo = TRUE)
ln1 <- matrix(runif(6), ncol=2) %>% Line()
str(ln1); ln1
ln2 <- Line(matrix(runif(6), ncol=2))
lns1 <- Lines(list(ln1), ID = c("hwy1"))
lns2 <- Lines(list(ln2), ID = c("hwy2"))
str(lns1)
sp_lns <- SpatialLines(list(lns1, lns2))
str(sp_lns)
# ---
sp_lns@bbox #會是所有line(即lines)的 x,y 之最大最小值。
ln1@coords[,1] %>% range
ln1@coords[,2] %>% range
ln2@coords[,1] %>% range
ln2@coords[,2] %>% range
dfr <- data.frame(id = c("hwy1", "hwy2"), # note how we use the same IDs from above!
cars_per_hour = c(78, 22))
sp_lns_dfr <- SpatialLinesDataFrame(sp_lns, dfr, match.ID = "id")
str(sp_lns_dfr)
lnstr_sfg1 <- st_linestring(matrix(runif(6), ncol=2))
lnstr_sfg2 <- st_linestring(matrix(runif(6), ncol=2))
class(lnstr_sfg1)
lnstr_sfg1
lnstr_sfg1 <- st_linestring(matrix(runif(6), ncol=2))
lnstr_sfg2 <- st_linestring(matrix(runif(6), ncol=2))
class(lnstr_sfg1)
lnstr_sfg1
lnstr_sfg1 <- st_linestring(matrix(runif(6), ncol=2))
lnstr_sfg2 <- st_linestring(matrix(runif(6), ncol=2))
class(lnstr_sfg1)
lnstr_sfg1
lnstr_sfg1 %>% str
lnstr_sfc <- st_sfc(lnstr_sfg1, lnstr_sfg2) # just one feature here
lnstr_sfc
lnstr_sfc %>% str
lnstr_sfc[1, ]
lnstr_sfc[1]
lnstr_sfc[[1]]
lnstr_sfc[[2]]
lnstr_sfc
lnstr_sfc <- st_sfc(lnstr_sfg1, lnstr_sfg2) # just one feature here
lnstr_sfc
lnstr_sf <- st_sf(dfr , lnstr_sfc)
lnstr_sf
#> Simple feature collection with 2 features
dfr
lnstr_sf <- st_sf(dfr , lnstr_sfc)
lnstr_sf
lnstr_sf[[1]]
lnstr_sf$lnstr_sfc[[1]]
lnstr_sf$lnstr_sfc
methods(class="sf")
philly_homicides_df <- read.csv("data/philly_homicides.csv")
philly_homicides_df <- read.csv("../data/philly_homicides.csv")
str(philly_homicides_df )
philly_homicides_sf <- st_as_sf(philly_homicides_df, coords = c("POINT_X", "POINT_Y"))
str(philly_homicides_sf)
philly_homicides_sf$geometry
st_crs(philly_homicides_sf)
st_crs(philly_homicides_sf) <- 4326 # we can use EPSG as numeric here
st_crs(philly_homicides_sf)
st_write(philly_homicides_sf, "../data/PhillyHomicides", driver = "ESRI Shapefile")
st_write(philly_homicides_sf, "../data/PhillyHomicides", driver = "ESRI Shapefile")
# to force the save:
st_write(philly_homicides_sf, "../data/PhillyHomicides", driver = "ESRI Shapefile",
delete_layer = TRUE)
class(philly_homicides_df)
coordinates(philly_homicides_df) <- c("POINT_X", "POINT_Y")
class(philly_homicides_df) # !!
is.projected(philly_homicides_df) # see if a projection is defined
proj4string(philly_homicides_df) <- CRS("+init=epsg:4326") # this is WGS84
is.projected(philly_homicides_df) # voila! hm. wait a minute..
proj4string(philly_homicides_df) <- CRS(projargs = "+init=epsg:4326") # this is WGS84
is.projected(philly_homicides_df) # voila! hm. wait a minute..
proj4string(philly_homicides_df) <- CRS(SRS_string = "EPSG:4326") # this is WGS84
is.projected(philly_homicides_df) # voila! hm. wait a minute..
proj4string(philly_homicides_df) <- CRS("+init=epsg:4326") # this is WGS84
is.projected(philly_homicides_df) # voila! hm. wait a minute..
# to save out using writeOGR from rgdal
library(rgdal)
# note that we need to save the philly_homicides_df, which we converted to sp object!
writeOGR(obj = philly_homicides_df,
dsn = "../data/PhillyHomicides",
layer = "PhillyHomcides", driver = "ESRI Shapefile")
# note that we need to save the philly_homicides_df, which we converted to sp object!
writeOGR(obj = philly_homicides_df,
dsn = "../data/PhillyHomicides",
layer = "PhillyHomicides", driver = "ESRI Shapefile")
# to save out using writeOGR from rgdal
library(rgdal)
# note that we need to save the philly_homicides_df, which we converted to sp object!
writeOGR(obj = philly_homicides_df,
dsn = "../data/PhillyHomicides",
layer = "PhillyHomicides", driver = "ESRI Shapefile")
# to force save:
writeOGR(obj = philly_homicides_df,
dsn = "../data/PhillyHomicides",
layer = "PhillyHomcides",
driver = "ESRI Shapefile",
overwrite_layer = TRUE)
philly_homicides_df
proj4string %>% str
proj4string(philly_homicides_df) <- CRS("+init=epsg:4326") # this is WGS84
is.projected(philly_homicides_df) # voila! hm. wait a minute..
proj4string %>% str
# read in
philly_sf <- st_read("data/Philly/")
# read in
philly_sf <- st_read("../data/Philly/")
# to save out using writeOGR from rgdal
library(rgdal)
# note that we need to save the philly_homicides_df, which we converted to sp object!
writeOGR(obj = philly_homicides_df,
dsn = "../data/PhillyHomicides",
layer = "PhillyHomicides", driver = "ESRI Shapefile")
# to force save:
writeOGR(obj = philly_homicides_df,
dsn = "../data/PhillyHomicides",
layer = "PhillyHomicides",
driver = "ESRI Shapefile",
overwrite_layer = TRUE)
# read in
philly_sf <- st_read("../data/Philly")
philly_sf %>% str
plot(philly_sf)
plot(philly_sf)
philly_sf %>% st_geometry()
philly_sf %>% st_geometry() %>% plot
# subset the familar way
philly_sf_rich <- philly_sf[philly_sf$medHHinc > 60000, ]
# or
philly_sf_rich <- subset(philly_sf, medHHinc > 60000)
plot(st_geometry(philly_sf_rich), add=T, col="red")
philly_sf %>% st_geometry() %>% plot
plot(st_geometry(philly_sf_rich), add=T, col="red")
# ---
philly_sf %>% st_geometry() %>% plot
plot(st_geometry(philly_sf_rich), add=T, col="red")
philly_sf %>% st_geometry() %>% plot
plot(st_geometry(philly_sf_rich), add=T, col="red")
philly_sf_rich
philly_sf_rich %>% plot
philly_sf %>% st_geometry() %>% plot
plot(st_geometry(philly_sf_rich), add = T, col = "red")
philly_sf
philly_sf %>% str
philly_sf %>%
filter(medHHinc > 60000) %>%
st_geometry() %>%
plot(col = "red", add = T)
philly_sf %>% st_geometry() %>% plot
philly_sf %>%
filter(medHHinc > 60000) %>%
st_geometry() %>%
plot(col = "red", add = T)
library(rgdal)
philly_sp <- readOGR("data/Philly/", "PhillyTotalPopHHinc")
philly_sp <- readOGR("../data/Philly/", "PhillyTotalPopHHinc")
philly_sp <- readOGR("../data/Philly", "PhillyTotalPopHHinc")
philly_sp <- readOGR(dsn = "../data/Philly", layer = "PhillyTotalPopHHinc")
class(philly_sp)
plot(philly_sp)
philly_sp_rich <- subset(philly_sp, medHHinc > 60000)
plot(philly_sp_rich, add=T, col="red")
r <- raster(xmn=-0.5, ymn=-0.5, xmx=4.5, ymx=4.5, resolution=c(1,1))
library(raster)
r <- raster(xmn=-0.5, ymn=-0.5, xmx=4.5, ymx=4.5, resolution=c(1,1))
r
r <- raster(xmn=-0.5, ymn=-0.5, xmx=4.5, ymx=4.5, resolution = c(1,2))
r
library(raster)
r <- raster(xmn=-0.5, ymn=-0.5, xmx=4.5, ymx=4.5, resolution = c(1,1))
r
class(r)
r
r <- setValues(r, runif(25))
class(r)
r
r$layer
r$layer$layer
r$layer@data
r <- setValues(r, runif(25))
class(r)
r
plot(r); points(coordinates(r), pch=3)
plot(r)
points(coordinates(r), pch=3)
plot(r); points(coordinates(r), pch=3)
plot(r); points(coordinates(r), pch = 4)
plot(r); points(coordinates(r), pch = 3)
coordinates(r)
coordinates(r)
plot(r); points(coordinates(r), pch = 3)
class(volcano)
volcano
class(volcano)
volcano %>% head
class(volcano)
volcano %>% dim
volcano.r <- raster(x = volcano)
class(volcano.r)
library(raster)
HARV <- raster("../data/HARV_RGB_Ortho.tif")
HARV
plot(HARV)
crs(HARV)
methods(class = class(HARV))
hist(HARV)
ncell(HARV)
hist(HARV, maxpixels = ncell(HARV))
GDALinfo("../data/HARV_RGB_Ortho.tif")
GDALinfo("../data/HARV_RGB_Ortho.tif")
nlayers(HARV)
HARV_Band2 <- raster("data/HARV_RGB_Ortho.tif", band = 2)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 2)
plot(HARV_Band2)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 3)
plot(HARV_Band2)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 4)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 3)
plot(HARV_Band2)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 2)
plot(HARV_Band2)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 1)
plot(HARV_Band2)
HARV_Band2 <- raster("../data/HARV_RGB_Ortho.tif", band = 2)
plot(HARV_Band2)
nbands(HARV)
HARV_stack <- stack("data/HARV_RGB_Ortho.tif")
HARV_stack <- stack("../data/HARV_RGB_Ortho.tif")
# how many layers?
nlayers(HARV_stack)
# how many layers?
nlayers(HARV_stack)
nbands(HARV_stack)
# how many layers?
nlayers(HARV_stack) #3
# nbands(HARV_stack) #會是error。not implemented for RasterStack objects
HARV_stack
HARV_Band2
plot(HARV_stack)
plotRGB(HARV_stack)
plotRGB(HARV_stack)
object.size(HARV_stack)
HARV_brick <- brick(HARV_stack)
object.size(HARV_brick)
# specify the grid topology with the following parameters:
# - the smallest coordinates for each dimension, here: 0,0
# - cell size in each dimension, here: 1,1
# - number of cells in each dimension, here: 5,5
gtopo <- GridTopology(cellcentre.offset = c(0,0),
cellsize = c(1,1),
cells.dim = c(5,5)) # create the grid
datafr <- data.frame(runif(25)) # make up some data
SpGdf <- SpatialGridDataFrame(gtopo, datafr) # create the grid data frame
summary(SpGdf)
plot(SpGdf)
plot(SpGdf, pch = 3)
coordinates(SpGdf)
coordinates(SpGdf) #coordinate會是grid的中心~
plot(SpGdf); points(coordinates(SpGdf), pch = 3)
coordinates(r) #coordinate會是grid的中心~
plot(r); points(coordinates(r), pch = 3)
coordinates(SpGdf) #coordinate會是grid的中心~
plot(SpGdf); points(coordinates(SpGdf), pch = 3)
plot(SpGdf)
coordinates(SpGdf) #coordinate會是grid的中心~
plot(SpGdf); points(coordinates(SpGdf), pch = 3)
ph_edu <- read.csv("../data/PhiladelphiaEduAttain.csv")
ph_edu <- read.csv("../data/PhillyEducation.csv")
names(ph_edu)
## sf ##
# if you need to read in again:
philly_sf <- st_read("../data/Philly")
names(philly_sf)
philly_sf_merged <- merge(x = philly_sf, y = ph_edu,
by.x = "GEOID10", by.y = "GEOID")
names(philly_sf_merged)
## sp ##
# if you need to read in again:
# philly_sp <- readOGR("data/Philly/", "PhillyTotalPopHHinc")
philly_sp %>% str
## sp ##
# if you need to read in again:
philly_sp <- readOGR(dsn = "../data/Philly/", layer = "PhillyTotalPopHHinc")
## sp ##
# if you need to read in again:
philly_sp <- readOGR(dsn = "../data/Philly", layer = "PhillyTotalPopHHinc")
# this is sp::merge()
philly_sp_merged <- sp::merge(philly_sp, ph_edu, by.x = "GEOID10", by.y = "GEOID")
names(philly_sp_merged) # no geometry column here
# if you need to read in again:
philly_sf <- st_read(dsn = "data/Philly", quiet = T)
# if you need to read in again:
philly_sf <- st_read(dsn = "../data/Philly", quiet = T)
# make a simple feature point with CRS
philly_ctr_sfc <- st_point(c(1750160, 467499.9)) %>% st_sfc(., crs = 102003)
philly_ctr_sfc
philly_sf
philly_sf %>% str
philly_ctr_sfc
philly_ctr_sfc %>% str
philly_ctr_sfc
philly_buf_sf <- st_buffer(philly_ctr_sfc, dist = 2000) #單位為meter
philly_buf_sf
plot(philly_buf_sf)
plot(philly_ctr_sfc)
philly_buf_intersects <- st_intersects(philly_buf_sf, philly_sf)
#> Error in st_geos_binop("intersects", x, y, sparse = sparse, prepared = prepared) :
#> st_crs(x) == st_crs(y) is not TRUE
st_crs(philly_sf)
st_crs(philly_buf_sf)
philly_buf_intersects
st_crs(philly_sf) <- 102003
st_crs(philly_sf)
class(philly_buf_intersects)
philly_buf_intersects <- st_intersects(philly_buf_sf, philly_sf)
class(philly_buf_intersects)
philly_buf_intersects
philly_buf_intersects %>% head
philly_buf_intersects
plot(philly_buf_intersects)
philly_buf_intersects
philly_buf_intersects[[1]]
philly_sel_sf <- philly_sf[philly_buf_intersects[[1]], ]
philly_sel_sf <- philly_sf[philly_buf_intersects[[1]], ]
# plot
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add=T, col="red")
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add=T, col="red")
st_geometry(philly_sel_sf)
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2)
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = "green")
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = "green", alpha = 0.5)
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = "green", alpha = 0.2)
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = alpha("green", 0.2))
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = "green", alpha = 0)
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = "green", alpha = 0.8)
# plot
library(scales)
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = alpha("green", 0.2))
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2, col = alpha("green", 0.5))
plot(st_geometry(philly_sf),
border = "#aaaaaa", #灰色
main = "Census tracts that fall within 2km of city center")
plot(st_geometry(philly_sel_sf), add = T, col = "red")
plot(st_geometry(philly_buf_sf), add = T, lwd = 2, lty = 2,
col = scales::alpha("green", 0.5))
library(rgeos)
# if you need to read it in again
# verbose: report progress
philly_sp <- readOGR(dsn = "../data/Philly",
layer = "PhillyTotalPopHHinc",
verbose = F)
# if you need to read it in again
# verbose: report progress
philly_sp <- readOGR(dsn = "../data/Philly",
layer = "PhillyTotalPopHHinc",
verbose = T)
coords <- data.frame(x = 1750160, y = 467499.9) # set the coordinates
prj <- CRS("+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs") # the projection string for AEA
philly_ctr_sp <- SpatialPoints(coords, proj4string = prj) # create the spatialPoints
philly_ctr_sp %>% str
philly_buf_sp <- gBuffer(spgeom = philly_ctr_sp, width=2000) # create buffer around center
plot(philly_ctr_sp)
plot(philly_buf_sp)
philly_buf_sp %>% str
philly_buf_intersects <-  gIntersects(spgeom1 = philly_buf_sp,
spgeom2 = philly_sp,
byid=TRUE)
# what kind of object is this?
class(philly_buf_intersects)
philly_buf_intersects
philly_buf_intersects %>% dim
# subset
philly_sel_sp <- philly_sp[as.vector(philly_buf_intersects),]
plot (philly_sp, border="#aaaaaa")
plot (philly_sel_sp, add=T, col="red")
plot (philly_buf_sp, add=T, lwd = 2)
plot (philly_sp, border = "#aaaaaa")
plot (philly_sel_sp, add = T, col = "red")
plot (philly_buf_sp, add = T, lwd = 2, col = scales::alpha("green", 0.2))
plot (philly_sp, border = "#aaaaaa")
plot (philly_sel_sp, add = T, col = "red")
plot (philly_buf_sp, add = T, lwd = 2, col = scales::alpha("green", 0.5))
#If you need to read the file back in:
philly_homicides_sf <- st_read(dsn = "../data/PhillyHomicides")
st_crs(philly_sf)
st_crs(philly_homicides_sf)
#If you need to read the file back in:
philly_homicides_sf <- st_read(dsn = "../data/PhillyHomicides")
st_crs(philly_homicides_sf)
st_crs(philly_sf)
#If you need to read the file back in:
# philly_homicides_sf <- st_read(dsn = "../data/PhillyHomicides")
st_crs(philly_homicides_sf)
st_crs(philly_sf)
st_crs(philly_sf)
philly_homicides_sf_aea <- st_transform(x = philly_homicides_sf,
crs = st_crs(philly_sf))
st_crs(philly_homicides_sf_aea)
st_crs(philly_sf)
st_coordinates(philly_homicides_sf) %>% range()
st_coordinates(philly_homicides_sf_aea) %>% range()
par(mfrow=c(1,2))
plot(st_geometry(philly_homicides_sf), axes=TRUE, main = "before transform - latlon")
plot(st_geometry(philly_homicides_sf_aea), axes=TRUE, main = "after transform - aea")
